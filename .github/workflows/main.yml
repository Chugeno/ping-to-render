name: keep-alive

on:
  schedule:
    - cron: "*/14 * * * *"
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      # Paso 1: Intentar despertar a Render
      - name: Wake Render (GET)
        id: wake_step
        # Quitamos el "|| true" para que si falla, GitHub sepa que fallÃ³
        run: curl -fsS https://google.com/esta-pagina-no-existe

      # Paso 2: Avisar por ntfy SOLO si lo de arriba fallÃ³
      - name: ðŸš¨ Alerta de Error
        if: failure()  # <--- ESTA ES LA MAGIA
        run: |
          curl \
            -d "âš ï¸ OJO: El ping a n8n fallÃ³. Render podrÃ­a estar caÃ­do o dormido." \
            -H "Title: Error en n8n Keep-Alive" \
            -H "Priority: high" \
            -H "Tags: warning,skull" \
            ntfy.sh/eugenio-bamzUf-2dijqy-gahtan
